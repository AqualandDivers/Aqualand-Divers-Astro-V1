---
import Contact from "@components/Contact/Contact.astro";
import StoreImage from "@components/Store/StoreImage.astro";
import StoreGrid from "@components/Store/StoreGrid.astro";
import { Image } from "astro:assets";
import { type CollectionEntry, getCollection } from "astro:content";

import BaseLayout from "./BaseLayout.astro";
import heroImage from "@images/MainBGImageReplaceSecond.jpg";
import heroImageMobile from "@images/MainBGImageReplaceSecond.jpg";

interface Props {
	store: CollectionEntry<"store">;
}

import headerImage from "@images/portfolio-header-crop-min.jpg";

const { store } = Astro.props as Props;
const { title, description, images = [], header } = store.data; //date, clients removed

// find other stores to show later down the page
const otherStores = await getCollection("store", (otherStore) => {
	// filter out draft pages
	return otherStore.data.draft !== false && otherStore.id !== store.id;
});
---

<BaseLayout
	type="general"
	title={title}
	description={description}
	navStartStyle="white"
>

	<section id="hero" class="relative z-10 flex min-h-[30lvh] w-full">
		<!-- background image -->
		<div class="absolute -z-10 h-full min-h-full overflow-hidden w-full">
			<div class="absolute inset-0 bg-black/10 mix-blend-hard-light"></div>
			<Image
				src={heroImage}
				class="hidden h-full w-full object-cover object-bottom sm:block bg-transparent"
				alt="diving"
				aria-hidden="false"
				loading="eager"
				width={1920}
			/>
			<Image
				src={heroImageMobile}
				class="h-full w-full object-cover sm:hidden"
				alt="diving"
				aria-hidden="true"
				loading="eager"
				width={600}
			/>
		</div>

		<!-- hero items -->
		<div class="site-container relative w-full gap-10 py-44 text-center md:py-52 md:text-left">
			<!-- Hero text -->
			<div class="text-base-50 my-auto mr-auto max-w-[800px] flex-col">
				<h1
					class="font-heading-1 text-4xl font-semibold text-pretty md:text-7xl"
				>
					{title}
				</h1>
			</div>
		</div>
	</section>

	<article class="mx-auto mt-12 px-4 md:mt-20 md:max-w-6xl">

		<!-- hero image -->
		<!-- <div class="mt-6 h-auto max-h-[50vh] w-full overflow-hidden md:max-h-[80vh]">
			<Image
				src={heroImage}
				alt={`cover for ${title}`}
				width={1120}
				quality="high"
				densities={[1.5, 2]}
				class="h-auto min-h-full w-full min-w-full object-cover"
				transition:name={`portfolio-image-${portfolio.id}`}
			/>
		</div> -->

		<!-- people and location
		<h2
			class="h3 text-[#273fa3] mt-10 flex flex-col items-center justify-center gap-x-3 gap-y-1 tracking-widest md:flex-row"
		>
			<div>
				{clients.join(" & ")}
			</div>
			<span class="hidden md:inline">|</span>
			<hr class="border-[#273fa3]400 w-1/3 md:hidden" />
			<span>{location}</span>
		</h2> -->

		<!-- slot really only fuctions as a longer description -->
		<section
			id="main"
			class="mx-auto max-w-md scroll-mt-10 px-4 py-8 md:max-w-6xl md:py-12"
		>
			<h2 class="h2 md:px-12 lg:text-6xl">{title}</h2>
			<div class="grid gap-y-10 md:grid-cols-2">
				<Image
					src={header}
					alt="header image"
					width={450}
					densities={[1.5, 2]}
					class="w-full object-cover"
				/>
				<div class="md:pr-16 md:pl-28 text-4xl text-pretty md:text-4xl">
					{(store.body || '').trim().split('\n').filter(line => line.trim()).map((line) => (
						<p>{line}</p>
					))}
					<div class="lg:text-lg"><br /><p>If you are interested in purchasing a listed product, please contact us, or visit in store.</p></div>
					<!-- second half -->
				</div>
			</div>
		</section>

		<!-- store images -->
		<div class="mx-auto mt-12 max-w-5xl space-y-6 md:mt-20 md:space-y-16">
			<div
				class:list={[
					"mb-6 grid gap-6 md:gap-16",
					{
						"grid-cols-1": images.length === 1,
						"grid-cols-2": images.length === 2,
						"grid-cols-3": images.length >= 3,
					},
				]}
			>
				{images.map((image) => (
					<StoreImage image={image} numCols={images.length} />
				))}
			</div>
		</div>
	</article>

	<section class="mx-auto mt-12 px-4 md:mt-16 md:max-w-5xl">
		<h3 class="h2 text-center">More Store Items</h3>
		<StoreGrid stores={otherStores} noTransitions />
	</section>
	<Contact class="mt-12" />
</BaseLayout>
